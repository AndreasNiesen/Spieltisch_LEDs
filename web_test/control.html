<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>

    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        input.color_picker {
            width: 8rem;
            padding: 0.25rem;
        }
    </style>
</head>
<body>
    <header class="menu">
        <div class="menu_point">
            <h3 id="single_mode">Feste Farbe</h3>
        </div>
        <div class="menu_point">
            <h3 id="effect_mode">Muster</h3>
        </div>
        <div class="menu_point">
            <h3 id="game_mode">Spieler-Modus</h3>
        </div>
    </header>
    <main>
        <section class="single_mode" id="single_mode_section">
            <div class="section_title">
                <h1>Feste Farbe</h1>
            </div>
            <div class="color_choice_all">
                <div class="color_choice">
                    <div class="color_choice_slider">
                        <div class="slider slider_r">
                            <label for="color_red">Rot:</label>
                            <input type="range" id="color_red" min="0" max="255" value="255" class="single_color_slider">
                        </div>
                        <div class="slider slider_g">
                            <label for="color_green">Grün:</label>
                            <input type="range" id="color_green" min="0" max="255" value="0" class="single_color_slider">
                        </div>
                        <div class="slider slider_b">
                            <label for="color_blue">Blau:</label>
                            <input type="range" id="color_blue" min="0" max="255" value="0" class="single_color_slider">
                        </div>
                    </div>
                </div>
                <div class="color_choice_full">
                    <label for="color_picker_feste_farbe">Farbwahl:</label>
                    <input type="color" id="color_picker_feste_farbe" value="#ff0000" class="color_picker">
                </div>
            </div>
        </section>

        <section class="effect_mode" id="effect_mode_section">
            <div class="section_title">
                <h1>Muster</h1>
            </div>
            <div class="effect_choice">
                <select name="effect_mode_choice" id="effect_mode_choice">
                    <Option value="0">Einfarb-Karusell</Option>
                    <Option value="1">Mehrfarb-Karusell</Option>
                    <Option value="2">Mehrfarb-Blinken</Option>
                    <Option value="3">Mehrfarb-Rotation</Option>
                    <Option value="4">Random-Mode</Option>
                </select>
            </div>
            <div class="effect_choice_options">
                <div class="effect_choice_options_x effect_choice_options_0">
                    <!-- Einfarb-Karusell -->
                    <h3>Einfarb-Karusell</h3>
                    <div class="options">
                        <div class="option">
                            <label for="len_0">Länge</label>
                            <input id="len_0" type="number">
                        </div>
                        <div class="option">
                            <label for="spd_0">Geschwindigkeit</label>
                            <input id="spd_0" type="number">
                            <label class="einheit">LED/s</label>
                        </div>
                        <div class="option">
                            <div class="color_choice_all">
                                <div class="color_choice">
                                    <div class="color_choice_slider">
                                        <div class="slider slider_r">
                                            <label for="color_red_0">Rot:</label>
                                            <input type="range" id="color_red_0" min="0" max="255" value="255" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_g">
                                            <label for="color_green_0">Grün:</label>
                                            <input type="range" id="color_green_0" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_b">
                                            <label for="color_blue_0">Blau:</label>
                                            <input type="range" id="color_blue_0" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                    </div>
                                </div>
                                <div class="color_choice_full">
                                    <label for="color_0">Farbe</label>
                                    <input type="color" id="color_0" value="#ff0000" class="color_picker">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="effect_choice_options_x effect_choice_options_1">
                    <!-- Mehrfarb-Karusell -->
                    <h3>Mehrfarb-Karusell</h3>
                    <div class="option">
                        <label for="spd_1">Geschwindigkeit</label>
                        <input id="spd_1" type="number">
                        <label class="einheit">LED/s</label>
                    </div>
                    <div class="option">
                        <div class="mfk mfk_0">
                            <div class="color_choice_all">
                                <div class="color_choice">
                                    <div class="color_choice_slider">
                                        <div class="slider slider_r">
                                            <label for="color_red_1_0">Rot:</label>
                                            <input type="range" id="color_red_1_0" min="0" max="255" value="255" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_g">
                                            <label for="color_green_1_0">Grün:</label>
                                            <input type="range" id="color_green_1_0" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_b">
                                            <label for="color_blue_1_0">Blau:</label>
                                            <input type="range" id="color_blue_1_0" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                    </div>
                                </div>
                                <div class="color_choice_full">
                                    <label for="color_1_0">Farbe</label>
                                    <input type="color" id="color_1_0" value="#ff0000" class="color_picker">
                                </div>
                            </div>
                        </div>
                        <div class="mfk mfk_1">
                            <div class="color_choice_all">
                                <div class="color_choice">
                                    <div class="color_choice_slider">
                                        <div class="slider slider_r">
                                            <label for="color_red_1_1">Rot:</label>
                                            <input type="range" id="color_red_1_1" min="0" max="255" value="255" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_g">
                                            <label for="color_green_1_1">Grün:</label>
                                            <input type="range" id="color_green_1_1" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_b">
                                            <label for="color_blue_1_1">Blau:</label>
                                            <input type="range" id="color_blue_1_1" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                    </div>
                                </div>
                                <div class="color_choice_full">
                                    <label for="color_1_1">Farbe</label>
                                    <input type="color" id="color_1_1" value="#ff0000" class="color_picker">
                                </div>
                            </div>
                        </div>
                        <div class="mfk mfk_2">
                            <div class="color_choice_all">
                                <div class="color_choice">
                                    <div class="color_choice_slider">
                                        <div class="slider slider_r">
                                            <label for="color_red_1_2">Rot:</label>
                                            <input type="range" id="color_red_1_2" min="0" max="255" value="255" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_g">
                                            <label for="color_green_1_2">Grün:</label>
                                            <input type="range" id="color_green_1_2" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                        <div class="slider slider_b">
                                            <label for="color_blue_1_2">Blau:</label>
                                            <input type="range" id="color_blue_1_2" min="0" max="255" value="0" class="single_color_slider">
                                        </div>
                                    </div>
                                </div>
                                <div class="color_choice_full">
                                    <label for="color_1_2">Farbe</label>
                                    <input type="color" id="color_1_2" value="#ff0000" class="color_picker">
                                </div>
                            </div>
                        </div>
                        <button>Farbe hinzufügen</button> <!-- Farben: Min 3, "Farbe hinzufügen" Option für mehr, Max 10 Farben -->
                    </div>
                    <!-- Länge: Anzahl Farben/Gesamtlänge -->
                </div>
                <div class="effect_choice_options_x effect_choice_options_2">
                    <h1>TO BE IMPLEMENTED</h1>
                    <!-- Mehrfarb-Blinken -->
                    <!--
                        Geschwindigkeit
                        Farben
                            Min 3, "Farbe hinzufügen" Option für mehr, Max 10 Farben
                            Länge pro Farbe (vs Gesamtlänge/Anzahl farben)
                    -->
                </div>
                <div class="effect_choice_options_x effect_choice_options_3">
                    <h1>TO BE IMPLEMENTED</h1>
                    <!-- Mehrfarb-Rota -->
                    <!--
                        Alle LEDs eine Farbe, stetiger wechsel zur nächsten Farbe
                        Optionen:
                        - Geschwindigkeit (Dauer von einem Stop zum Nächsten)
                        Farben:
                        - min 3, max 10
                        - stetiger Wechsel von Farbe zu Farbe (bewegung der einzelnen Kanäle richtung Ziel)
                        - von letzter zu erster
                        - Button um weitere Farben hinzuzufügen
                    -->
                </div>
                <div class="effect_choice_options_x effect_choice_options_4">
                    <h1>TO BE IMPLEMENTED</h1>
                    <!-- Random-Mode -->
                    <!--
                        Wechsel-Geschwindigkeit
                        Options Black/Whitelist (?)
                        "Warnung": Optionen die grad bei den anderen eingestellt sind werden genommen
                    -->
                </div>
                <!--
                    OPTIONAL: Beispielanimation des effekts
                    OK-Button zum senden des Effektes mit Einstellungen
                -->
            </div>
        </section>

        <section class="game_mode" id="game_mode_section">
            <div class="section_title">
                <h1>Spieler-Modus</h1>
            </div>
            <div class="game_options">
                <h1>TO BE IMPLEMENTED</h1>
                <!--
                    Optionen für Spielmodus
                    - Anzahl Spieler
                    - Position pro Spieler
                    -- Evtl mit live-auswahl-"animation"?
                    - Spieler "breite" (allgemein)
                -->
            </div>
        </section>
    </main>

    <!--
        Inline-JS, to minimize the amount of web-related-files
    -->
    <script>
        const HOST = "127.0.0.1";
        const PORT = "9001";
        let last_send = 0;

        let SLIDER_RED = 255;
        let SLIDER_GREEN = 0;
        let SLIDER_BLUE = 0;

        const slider_r = document.getElementById("color_red");
        const slider_g = document.getElementById("color_green");
        const slider_b = document.getElementById("color_blue");

        const color_picker = document.getElementsByClassName("color_picker")[0];

        function send_color(color_code) {
            if (Date.now() - last_send < 300 /*ms*/) return;

            last_send = Date.now();

            let full_url = `http://${HOST}:${PORT}/color.html?color=${color_code.slice(-6)}`;

            // fetch(full_url);
        }

        function toHex(i) {
            return (("0" + i.toString(16)).slice(-2));
        }

        color_picker.addEventListener("change", e => {
            let color_string = e.target.value.slice(-6);

            SLIDER_RED = parseInt(color_string.slice(0, 2), 16);
            slider_r.value = SLIDER_RED;

            SLIDER_GREEN = parseInt(color_string.slice(2, 4), 16);
            slider_g.value = SLIDER_GREEN;
            
            SLIDER_BLUE = parseInt(color_string.slice(4), 16);
            slider_b.value = SLIDER_BLUE;

            send_color(e.target.value);
        })


        slider_r.addEventListener("input", e => {
            SLIDER_RED = parseInt(e.target.value);

            color_picker.value = `#${toHex(SLIDER_RED)}${toHex(SLIDER_GREEN)}${toHex(SLIDER_BLUE)}`;
        });

        slider_g.addEventListener("input", e => {
            SLIDER_GREEN = parseInt(e.target.value);

            color_picker.value = `#${toHex(SLIDER_RED)}${toHex(SLIDER_GREEN)}${toHex(SLIDER_BLUE)}`;
        });

        slider_b.addEventListener("input", e => {
            SLIDER_BLUE = parseInt(e.target.value);

            color_picker.value = `#${toHex(SLIDER_RED)}${toHex(SLIDER_GREEN)}${toHex(SLIDER_BLUE)}`;
        });

        for (const scs of [slider_r, slider_g, slider_b]) {
            scs.addEventListener("change", e => {
                send_color(color_picker.value);
            });
        }
    </script>
</body>
</html>